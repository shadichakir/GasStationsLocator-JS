<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GasStationsLocator</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="author" content="ThemeStarz">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700|Varela+Round" rel="stylesheet">
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.css" type="text/css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.css" type="text/css">
    <link rel="stylesheet" href="assets/css/selectize.css" type="text/css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/user.css">
</head>
<body>
    <div class="page home-page">
        <!--*********************************************************************************************************-->
        <!--************ HERO ***************************************************************************************-->
        <!--*********************************************************************************************************-->
        <header class="hero has-map">
            <div class="hero-wrapper">
                <!--============ Secondary Navigation ===============================================================-->
                <div class="secondary-navigation">
                    <div class="container">
                        <ul class="left">
                            <li>
                                <span>
                                    <i class="fa fa-phone"></i> +212 52124585
                                </span>
                            </li>
                        </ul>
                        <!--end left-->
                        <ul class="right">
                            <li>
                                <a href="">
                                    <i class="fa fa-heart"></i>Mes Stations
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <i class="fa fa-sign-in"></i>Connexion
                                </a>
                            </li>
                            <li>
                                <a href="">
                                    <i class="fa fa-pencil-square-o"></i>Inscription
                                </a>
                            </li>
                        </ul>
                        <!--end right-->
                    </div>
                    <!--end container-->
                </div>
                <!--============ End Secondary Navigation ===========================================================-->
                <!--============ Main Navigation ====================================================================-->
                <div class="main-navigation">
                    <div class="container">
                        <nav class="navbar navbar-expand-lg navbar-light justify-content-between">
                            <a class="navbar-brand" href="">
                                <h3>Gas Stations Locator</h3>
                            </a>
                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                            <div class="collapse navbar-collapse" id="navbar">
                                <!--Main navigation list-->
                                <ul class="navbar-nav">
                                    <li class="nav-item active">
                                        <a class="nav-link" href="#">Accueil</a>
                                    </li>
                                 
                                         
                                    <li class="nav-item">
                                        <a class="nav-link" href="">Contact</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="" class="btn btn-primary text-caps btn-rounded btn-framed">Stations</a>
                                    </li>
                                </ul>
                                <!--Main navigation list-->
                            </div>
                            <!--end navbar-collapse-->
                        </nav>
                        <!--end navbar-->
                    </div>
                    <!--end container-->
                </div>
                <!--============ End Main Navigation ================================================================-->
            </div>
            <div class="map height-450px" id="map-homepage"></div>

            <!--============ Hero Form ==========================================================================-->
            <form class="hero-form form">
                <div class="container">
                    <!--Main Form-->
                    <div class="main-search-form">
                        <div class="form-row">
                            <div class="col-md-3 col-sm-3">
                                <div class="form-group">
                                    <label for="Ville" class="col-form-label">Ville</label>
                                    <input type="text" class="form-control" id="Ville" placeholder="La ville de recherche">
                                </div>
                                <!--end form-group-->
                            </div>
                            <!--end col-md-3-->
                            <div class="col-md-3 col-sm-3">
                                <div class="form-group">
                                    <label for="Quartier" class="col-form-label">Quartier</label>
                                    <input type="text" class="form-control" id="Quartier" placeholder="Le quartier">
                                </div>
                                <!--end form-group-->
                            </div>
                            <!--end col-md-3-->
                            <div class="col-md-3 col-sm-3">
                                <div class="form-group">
                                    <label for="CodePostal" class="col-form-label">Code Postal</label>
                                    <input type="text" class="form-control" id="CodePostal" placeholder="Le code postal">
                                </div>
                                <!--end form-group-->
                            </div>
                            <!--end col-md-3-->
                            <div class="col-md-3 col-sm-3">
                                <button type="submit" id="searchGas" class="btn btn-primary width-100">Rechercher</button>
                            </div>
                            <!--end col-md-3-->
                        </div>
                        <!--end form-row-->
                    </div>
                    <!--end main-search-form-->
            
                </div>
                <!--end container-->
            </form>
            <!--============ End Hero Form ======================================================================-->
                    </header>
        <!--end hero-->
      
        <!--*********************************************************************************************************-->
        <!--************ FOOTER *************************************************************************************-->
        <!--*********************************************************************************************************-->
        <footer class="footer">
            <div class="wrapper">
                <div class="container">
                    <div class="row">
                        <div class="col-md-5">
                            <a href="#" class="brand">
                                <img src="assets/img/logo.png" alt="">
                            </a>
                            <p>
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut nec tincidunt arcu, sit amet
                                fermentum sem. Class aptent taciti sociosqu ad litora torquent per conubia nostra.
                            </p>
                        </div>
                        <!--end col-md-5-->
                        <div class="col-md-3">
                            <h2>Navigation</h2>
                            <div class="row">
                                <div class="col-md-6 col-sm-6">
                                    <nav>
                                        <ul class="list-unstyled">
                                            <li>
                                                <a href="#">Home</a>
                                            </li>
                                            <li>
                                                <a href="#">Listing</a>
                                            </li>
                                            <li>
                                                <a href="#">Pages</a>
                                            </li>
                                            <li>
                                                <a href="#">Extras</a>
                                            </li>
                                            <li>
                                                <a href="#">Contact</a>
                                            </li>
                                            <li>
                                                <a href="#">Submit Ad</a>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                                <div class="col-md-6 col-sm-6">
                                    <nav>
                                        <ul class="list-unstyled">
                                            <li>
                                                <a href="#">My Ads</a>
                                            </li>
                                            <li>
                                                <a href="#">Sign In</a>
                                            </li>
                                            <li>
                                                <a href="#">Register</a>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <!--end col-md-3-->
                        <div class="col-md-4">
                            <h2>Contact</h2>
                            <address>
                                <figure>
                                    124 Abia Martin Drive<br>
                                    New York, NY 10011
                                </figure>
                                <br>
                                <strong>Email:</strong> <a href="#">hello@example.com</a>
                                <br>
                                <strong>Skype: </strong> Craigs
                                <br>
                                <br>
                                <a href="contact.html" class="btn btn-primary text-caps btn-framed">Contact Us</a>
                            </address>
                        </div>
                        <!--end col-md-4-->
                    </div>
                    <!--end row-->
                </div>
                <div class="background">
                    <div class="background-image original-size">
                        <img src="assets/img/footer-background-icons.jpg" alt="">
                    </div>
                    <!--end background-image-->
                </div>
                <!--end background-->
            </div>
        </footer>
        <!--end footer-->
    </div>
    <!--end page-->

    <script src="lib/jquery/dist/jquery.min.js"></script>
    <script src="lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
    <script type="text/javascript" src="assets/js/popper.min.js"></script>
    <script type="text/javascript" src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?v=3.exp&libraries=places,geometry&key=AIzaSyBn6_lZyqFFDxuySgH4kDSE3UonQGRD8Rc&language=fr&region=MA"></script>
    <script src="assets/js/selectize.min.js"></script>
    <script src="assets/js/masonry.pkgd.min.js"></script>
    <script src="assets/js/icheck.min.js"></script>
    <script src="assets/js/markerclusterer_packed.js"></script>
    <script src="assets/js/infobox.js"></script>
    <script src="assets/js/richmarker-compiled.js"></script>

    <script type="text/javascript">
        window.onload = function WindowLoad(event) {
            //Request Location
            if ("geolocation" in navigator) {
                // check if geolocation is supported/enabled on current browser
                navigator.geolocation.getCurrentPosition(
                    function success(position) {
                        // for when getting location is a success
                        console.log('latitude', position.coords.latitude,
                            'longitude', position.coords.longitude);
                        DisplayMap(position.coords.latitude,
                            position.coords.longitude);
                    },
                    function error(error_message) {
                        // for when getting location results in an error
                        console.error('An error has occured while retrieving' +
                            'location', error_message);
                        DisplayMap(null, null);
                    });
            } else {
                // geolocation is not supported
                // get your location some other way
                console.log('geolocation is not enabled on this browser')
                DisplayMap(null, null);
            }

            //Display Map
            function DisplayMap(lat, long) {
                if (lat == null || long == null) {
                    var myLatlng = new google.maps.LatLng(33.5731104, -7.5898434);
                    var myOptions = {
                        zoom: 10,
                        center: myLatlng,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    }
                    var map = new google.maps.Map(document.getElementById("map-homepage"), myOptions);
                }
                else {
                    var myLatlng = new google.maps.LatLng(lat, long);
                    var myOptions = {
                        zoom: 10,
                        center: myLatlng,
                        mapTypeId: google.maps.MapTypeId.ROADMAP
                    }
                    var map = new google.maps.Map(document.getElementById("map-homepage"), myOptions);
                    //GetCityNameFromLatLng(lat, long);
                }
            }

            function GetCityNameFromLatLng(lat, long) {
                var latlng;
                latlng = new google.maps.LatLng(lat, long);

                new google.maps.Geocoder().geocode({ 'latLng': latlng }, function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {
                        if (results[1]) {
                            var country = null, countryCode = null, city = null, cityAlt = null;
                            var c, lc, component;
                            for (var r = 0, rl = results.length; r < rl; r += 1) {
                                var result = results[r];

                                if (!city && result.types[0] === 'locality') {
                                    for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                                        component = result.address_components[c];

                                        if (component.types[0] === 'locality') {
                                            city = component.long_name;
                                            break;
                                        }
                                    }
                                }
                                else if (!city && !cityAlt && result.types[0] === 'administrative_area_level_1') {
                                    for (c = 0, lc = result.address_components.length; c < lc; c += 1) {
                                        component = result.address_components[c];

                                        if (component.types[0] === 'administrative_area_level_1') {
                                            cityAlt = component.long_name;
                                            break;
                                        }
                                    }
                                } else if (!country && result.types[0] === 'country') {
                                    country = result.address_components[0].long_name;
                                    countryCode = result.address_components[0].short_name;
                                }

                                if (city && country) {
                                    break;
                                }
                            }
                            $("#Ville").val(city);
                        }
                    }
                });
            }

            var villeAutoCompleteOptions = {
                types: ['(cities)'],
                componentRestrictions: { country: "ma" }
            };

            var villeInput = document.getElementById('Ville');
            var villePlaces = new google.maps.places.Autocomplete(villeInput, villeAutoCompleteOptions);


            villePlaces.addListener('place_changed', function () {
                var place = villePlaces.getPlace();
                if (!place.geometry) {
                    // User entered the name of a Place that was not suggested and
                    // pressed the Enter key, or the Place Details request failed.
                    window.alert("No details available for input: '" + place.name + "'");
                    return;
                }
                var boundsByCity = place.geometry.viewport;
                console.log(boundsByCity);
                var quartierAutoCompleteOptions = {
                    bounds: boundsByCity,
                    types: ['geocode'],
                    componentRestrictions: { country: "ma" }
                };


                var quartierInput = document.getElementById('Quartier');
                var autocomplete = new google.maps.places.Autocomplete(quartierInput, {
                    bounds: boundsByCity,
                    strictBounds: true,
                });

              
            });


        }
        $("#Ville").change(function () {
        });
        $(function () {
            var kmRadius = 20;
            $("form").submit(function (e) {
                e.preventDefault();
                var city = $("#Ville").val();
                var quartier = $("#Quartier").val();
                var zipCode = $("#CodePostal").val();
                if (city === "" || city === null) {

                }
                else if ((quartier !== "" || quartier !== null)) {
                    var geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ 'address': quartier }, function (results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            // Create the places service.
                            var myLatlng = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
                            var myOptions = {
                                zoom: 12,
                                center: myLatlng,
                                mapTypeId: google.maps.MapTypeId.ROADMAP
                            }
                            var map = new google.maps.Map(document.getElementById("map-homepage"), myOptions);
                            var service = new google.maps.places.PlacesService(map);


                            // Perform a nearby search.
                            service.nearbySearch(
                                { location: myLatlng, radius: kmRadius * 500, type: ['gas_station'] },
                                function (results, status, pagination) {
                                    if (status !== 'OK') return;

                                    createMarkers(results, map);

                                });

                        } else {
                            alert("Something got wrong " + status);
                        }
                    });
                }
                else if (zipCode !== "" || zipCode !== null) {
                    var geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ 'address': zipCode }, function (results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            // Create the places service.
                            var myLatlng = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
                            var myOptions = {
                                zoom: 12,
                                center: myLatlng,
                                mapTypeId: google.maps.MapTypeId.ROADMAP
                            }
                            var map = new google.maps.Map(document.getElementById("map-homepage"), myOptions);
                            var service = new google.maps.places.PlacesService(map);


                            // Perform a nearby search.
                            service.nearbySearch(
                                { location: myLatlng, radius: kmRadius * 500, type: ['gas_station'] },
                                function (results, status, pagination) {
                                    if (status !== 'OK') return;

                                    createMarkers(results, map);

                                });

                        } else {
                            alert("Something got wrong " + status);
                        }
                    });
                }
                else{
                    var geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ 'address': city + ', MA' }, function (results, status) {
                        if (status == google.maps.GeocoderStatus.OK) {
                            // Create the places service.
                            var myLatlng = new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng());
                            var myOptions = {
                                zoom: 11,
                                center: myLatlng,
                                mapTypeId: google.maps.MapTypeId.ROADMAP
                            }
                            var map = new google.maps.Map(document.getElementById("map-homepage"), myOptions);
                            var service = new google.maps.places.PlacesService(map);


                            // Perform a nearby search.
                            service.nearbySearch(
                                { location: myLatlng, radius: kmRadius * 1000, type: ['gas_station'] },
                                function (results, status, pagination) {
                                    if (status !== 'OK') return;

                                    createMarkers(results, map);

                                });

                        } else {
                            alert("Something got wrong " + status);
                        }
                    });
                }

            });

            function createMarkers(places, homeMap) {
                var bounds = new google.maps.LatLngBounds();

                for (var i = 0, place; place = places[i]; i++) {
                    var image = {
                        url: place.icon,
                        size: new google.maps.Size(60, 60),
                        origin: new google.maps.Point(0, 0),
                        anchor: new google.maps.Point(17, 34),
                        scaledSize: new google.maps.Size(25, 25)
                    };

                    var marker = new google.maps.Marker({
                        map: homeMap,
                        title: place.name,
                        icon: image,
                        position: place.geometry.location
                    });
                    marker = new google.maps.Circle({
                        map: homeMap,
                        strokeColor: '#000',
                        strokeWeight: 2,
                        strokeOpacity: 0.5,
                        fillColor: '#f0f0f0',
                        fillOpacity: 0.5,
                        radius: kmRadius * 1000
                    });


                    bounds.extend(place.geometry.location);
                }
                map.fitBounds(bounds);
            }

        });
    </script>

</body>
</html>
